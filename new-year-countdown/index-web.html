<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°å¹´å€’è®¡æ—¶</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="music-controls">
        <button id="musicToggle" class="music-btn">ğŸµ æ’­æ”¾éŸ³ä¹</button>
        <button id="musicMute" class="music-btn">ğŸ”‡</button>
    </div>
    
    <div id="autoplayHint" class="autoplay-hint">
        <div class="hint-content">
            <p>ğŸµ ç‚¹å‡»é¡µé¢ä»»æ„ä½ç½®å¼€å§‹æ’­æ”¾èƒŒæ™¯éŸ³ä¹</p>
            <small>ï¼ˆç°ä»£æµè§ˆå™¨éœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½æ’­æ”¾éŸ³é¢‘ï¼‰</small>
        </div>
    </div>
    
    <!-- èŠ‚æ—¥è£…é¥° -->
    <div class="lantern lantern-left"></div>
    <div class="lantern lantern-right"></div>
    
    <!-- ç¦å­—è£…é¥° -->
    <div class="fu-character fu-top-left">ç¦</div>
    <div class="fu-character fu-top-right">ç¦</div>
    <div class="fu-character fu-bottom-left">ç¦</div>
    <div class="fu-character fu-bottom-right">ç¦</div>
    
    <!-- æ˜¥è” -->
    <div class="spring-couplet spring-left">æ–°æ˜¥å¤§å‰</div>
    <div class="spring-couplet spring-right">ä¸‡äº‹å¦‚æ„</div>
    
    <div class="countdown-container">
        <h1 class="title">ğŸ‰ æ–°å¹´å€’è®¡æ—¶ ğŸ‰</h1>
        <div class="countdown">
            <div class="time-section">
                <div class="time-card">
                    <div class="time-value" id="days">00</div>
                    <div class="time-label">å¤©</div>
                </div>
                <div class="time-card">
                    <div class="time-value" id="hours">00</div>
                    <div class="time-label">å°æ—¶</div>
                </div>
                <div class="time-card">
                    <div class="time-value" id="minutes">00</div>
                    <div class="time-label">åˆ†é’Ÿ</div>
                </div>
                <div class="time-card">
                    <div class="time-value" id="seconds">00</div>
                    <div class="time-label">ç§’</div>
                </div>
            </div>
        </div>
        <div class="message" id="message">
            ğŸŠ è·ç¦»æ–°å¹´è¿˜æœ‰ ğŸŠ
        </div>
        <div class="blessings" id="blessings">
            æ–°å¹´å¿«ä¹ï¼Œä¸‡äº‹å¦‚æ„ï¼
        </div>
        <div class="fireworks">
            <div class="firework"></div>
            <div class="firework"></div>
            <div class="firework"></div>
        </div>
    </div>
    
    <script>
        let backgroundMusic = null;
        let isMusicPlaying = false;
        let isMusicMuted = false;

        function createAudioElement() {
            const audio = new Audio();
            const mp3Source = document.createElement('source');
            mp3Source.src = 'æ­å–œå‘è´¢.mp3';
            mp3Source.type = 'audio/mpeg';
            audio.appendChild(mp3Source);
            
            const m4aSource = document.createElement('source');
            m4aSource.src = 'æ­å–œå‘è´¢.m4a';
            m4aSource.type = 'audio/mp4';
            audio.appendChild(m4aSource);
            
            audio.loop = true;
            audio.volume = 0.5;
            return audio;
        }

        function toggleMusic() {
            if (!backgroundMusic) {
                backgroundMusic = createAudioElement();
            }
            
            if (isMusicPlaying) {
                backgroundMusic.pause();
                document.getElementById('musicToggle').textContent = 'ğŸµ æ’­æ”¾éŸ³ä¹';
                isMusicPlaying = false;
            } else {
                backgroundMusic.play().then(() => {
                    document.getElementById('musicToggle').textContent = 'â¸ï¸ æš‚åœéŸ³ä¹';
                    isMusicPlaying = true;
                    document.getElementById('autoplayHint').style.display = 'none';
                }).catch(error => {
                    console.error('æ’­æ”¾éŸ³ä¹å¤±è´¥:', error);
                    alert('éŸ³ä¹æ’­æ”¾å¤±è´¥ï¼Œè¯·æ£€æŸ¥éŸ³é¢‘æ–‡ä»¶æˆ–å°è¯•ç‚¹å‡»é¡µé¢å…¶ä»–ä½ç½®');
                });
            }
        }

        function toggleMute() {
            if (!backgroundMusic) return;
            
            if (isMusicMuted) {
                backgroundMusic.volume = 0.5;
                document.getElementById('musicMute').textContent = 'ğŸ”‡';
                isMusicMuted = false;
            } else {
                backgroundMusic.volume = 0;
                document.getElementById('musicMute').textContent = 'ğŸ”Š';
                isMusicMuted = true;
            }
        }

        function autoPlayMusic() {
            backgroundMusic = createAudioElement();
            
            // å°è¯•è‡ªåŠ¨æ’­æ”¾
            const playPromise = backgroundMusic.play();
            
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    // è‡ªåŠ¨æ’­æ”¾æˆåŠŸ
                    document.getElementById('musicToggle').textContent = 'â¸ï¸ æš‚åœéŸ³ä¹';
                    isMusicPlaying = true;
                    document.getElementById('autoplayHint').style.display = 'none';
                }).catch(error => {
                    // è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œæ˜¾ç¤ºæç¤º
                    console.log('éœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½æ’­æ”¾éŸ³ä¹');
                    document.getElementById('autoplayHint').style.display = 'flex';
                });
            }
        }

        function updateCountdown() {
            const now = new Date();
            const currentYear = now.getFullYear();
            const nextYear = currentYear + 1;
            const newYear = new Date(nextYear, 0, 1, 0, 0, 0, 0);
            
            const diff = newYear - now;
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            document.getElementById('days').textContent = days.toString().padStart(2, '0');
            document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
            document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
            document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
            
            if (diff <= 0) {
                document.getElementById('message').textContent = 'ğŸ‰ æ–°å¹´å¿«ä¹ï¼ğŸ‰';
                document.querySelector('.fireworks').classList.add('active');
                
                // æ–°å¹´åˆ°æ¥æ—¶è‡ªåŠ¨æ’­æ”¾éŸ³ä¹
                if (!isMusicPlaying && backgroundMusic) {
                    backgroundMusic.play().then(() => {
                        document.getElementById('musicToggle').textContent = 'â¸ï¸ æš‚åœéŸ³ä¹';
                        isMusicPlaying = true;
                        document.getElementById('autoplayHint').style.display = 'none';
                    });
                }
                
                // æ–°å¹´ç‰¹æ•ˆï¼šå¢åŠ æ›´å¤šçƒŸèŠ±å’Œçº¢åŒ…
                if (!document.querySelector('.new-year-celebration')) {
                    const celebration = document.createElement('div');
                    celebration.className = 'new-year-celebration';
                    celebration.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        pointer-events: none;
                        z-index: 9999;
                    `;
                    document.body.appendChild(celebration);
                    
                    // åˆ›å»ºæ›´å¤šçƒŸèŠ±
                    for (let i = 0; i < 20; i++) {
                        setTimeout(() => {
                            createFirework(celebration);
                        }, i * 200);
                    }
                    
                    // åˆ›å»ºæ›´å¤šçº¢åŒ…
                    for (let i = 0; i < 30; i++) {
                        setTimeout(() => {
                            createRedEnvelope();
                        }, i * 150);
                    }
                }
            }

        // åˆ›å»ºçƒŸèŠ±ç‰¹æ•ˆ
        function createFirework(container) {
            const firework = document.createElement('div');
            firework.style.cssText = `
                position: absolute;
                width: 8px;
                height: 8px;
                background: radial-gradient(circle, #ffd700, #ff6b6b, #ff4081);
                border-radius: 50%;
                animation: fireworkExplosion 1.5s ease-out forwards;
                left: ${Math.random() * 100}%;
                top: ${Math.random() * 100}%;
            `;
            container.appendChild(firework);
            
            setTimeout(() => {
                if (firework.parentNode) {
                    firework.parentNode.removeChild(firework);
                }
            }, 1500);
        }
        
        // å®šä¹‰çƒŸèŠ±çˆ†ç‚¸åŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fireworkExplosion {
                0% {
                    transform: scale(1);
                    opacity: 1;
                    box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7);
                }
                50% {
                    transform: scale(3);
                    opacity: 0.7;
                    box-shadow: 0 0 20px 10px rgba(255, 107, 107, 0.5);
                }
                100% {
                    transform: scale(5);
                    opacity: 0;
                    box-shadow: 0 0 40px 20px rgba(255, 64, 129, 0);
                }
            }
        `;
        document.head.appendChild(style);
        }

        // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
        function playClickSound() {
            const clickSound = new Audio();
            clickSound.src = data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==;
            clickSound.volume = 0.3;
            clickSound.play().catch(() => {});
        }

        document.getElementById('musicToggle').addEventListener('click', function() {
            playClickSound();
            toggleMusic();
        });
        
        document.getElementById('musicMute').addEventListener('click', function() {
            playClickSound();
            toggleMute();
        });
        
        // ç‚¹å‡»é¡µé¢ä»»æ„ä½ç½®å°è¯•æ’­æ”¾éŸ³ä¹
        document.addEventListener('click', function(event) {
            // å¦‚æœä¸æ˜¯æŒ‰é’®ç‚¹å‡»ï¼Œæ’­æ”¾éŸ³æ•ˆ
            if (!event.target.closest('.music-btn')) {
                playClickSound();
            }
            document.getElementById('autoplayHint').style.display = 'none';
            if (!isMusicPlaying && backgroundMusic) {
                toggleMusic();
            }
        });

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨å°è¯•æ’­æ”¾éŸ³ä¹
        window.addEventListener('load', autoPlayMusic);

        // ç”Ÿæˆé›ªèŠ±
        function createSnowflakes() {
            const snowflakes = ['â„ï¸', 'â…', 'â†', 'âœ¦', 'â‰'];
            const container = document.body;
            
            for (let i = 0; i < 30; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.textContent = snowflakes[Math.floor(Math.random() * snowflakes.length)];
                
                // éšæœºä½ç½®å’ŒåŠ¨ç”»
                snowflake.style.left = Math.random() * 100 + '%';
                snowflake.style.animationDuration = (Math.random() * 3 + 2) + 's';
                snowflake.style.animationDelay = Math.random() * 5 + 's';
                snowflake.style.fontSize = (Math.random() * 10 + 15) + 'px';
                
                container.appendChild(snowflake);
            }
        }

        // ç”Ÿæˆçº¢åŒ…é›¨
        function createRedEnvelopes() {
            const container = document.body;
            const redEnvelopes = ['ğŸ§§', 'ğŸ’°', 'ğŸ', 'âœ¨'];
            
            for (let i = 0; i < 15; i++) {
                const envelope = document.createElement('div');
                envelope.className = 'red-envelope';
                envelope.textContent = redEnvelopes[Math.floor(Math.random() * redEnvelopes.length)];
                
                // éšæœºä½ç½®å’ŒåŠ¨ç”»
                envelope.style.left = Math.random() * 100 + '%';
                envelope.style.animationDuration = (Math.random() * 5 + 3) + 's';
                envelope.style.animationDelay = Math.random() * 8 + 's';
                envelope.style.fontSize = (Math.random() * 8 + 20) + 'px';
                
                container.appendChild(envelope);
            }
        }

        // ç¥ç¦è¯­è½®æ’­
        const blessings = [
            "ğŸ‰ æ–°å¹´å¿«ä¹ï¼Œä¸‡äº‹å¦‚æ„ï¼ğŸ‰",
            "ğŸ§§ æ­å–œå‘è´¢ï¼Œçº¢åŒ…æ‹¿æ¥ï¼ğŸ§§", 
            "â¤ï¸ èº«ä½“å¥åº·ï¼Œé˜–å®¶å¹¸ç¦ï¼â¤ï¸",
            "ğŸ’° äº‹ä¸šé¡ºåˆ©ï¼Œè´¢æºå¹¿è¿›ï¼ğŸ’°",
            "âœ¨ å¿ƒæƒ³äº‹æˆï¼Œå¥½è¿è¿è¿ï¼âœ¨",
            "ğŸ˜Š ç¦æ°”æ»¡æ»¡ï¼Œç¬‘å£å¸¸å¼€ï¼ğŸ˜Š",
            "ğŸŠ å¹´å¹´æœ‰ä½™ï¼Œå²å²å¹³å®‰ï¼ğŸŠ",
            "ğŸŒŸ å¤§å‰å¤§åˆ©ï¼Œå¯Œè´µå‰ç¥¥ï¼ğŸŒŸ",
            "ğŸ‡ é˜–å®¶æ¬¢ä¹ï¼Œå¹¸ç¦å®‰åº·ï¼ğŸ‡",
            "ğŸ® å‰ç¥¥å¦‚æ„ï¼Œå¥½è¿å¸¸ä¼´ï¼ğŸ®"
        ];
        
        let blessingIndex = 0;
        function rotateBlessings() {
            const blessingElement = document.getElementById('blessings');
            blessingElement.textContent = blessings[blessingIndex];
            blessingIndex = (blessingIndex + 1) % blessings.length;
        }
        
        // é¡µé¢åŠ è½½åç”Ÿæˆé›ªèŠ±ã€çº¢åŒ…é›¨å’Œç¥ç¦è¯­
        window.addEventListener('load', function() {
            createSnowflakes();
            createRedEnvelopes();
            rotateBlessings();
            setInterval(rotateBlessings, 3000);
        });
        
        updateCountdown();
        setInterval(updateCountdown, 1000);
    </script>
</body>
</html>